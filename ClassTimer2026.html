<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link rel="icon" type="image/png" href="favicon.png">

<title>Classroom Timer 2026</title>
<style>
:root{
  --bg1: #040b14;
  --bg2: #0a1222;
  --muted: rgba(255,255,255,0.65);
  font-family: Inter, Arial, sans-serif;
}
html,body{
  margin:0;height:100%;
  background: linear-gradient(180deg, var(--bg1), var(--bg2));
  color:#fff;
}

#top-bar{
  text-align:center;
  padding:12px 0 4px;
}

#clockDateRow{
  display:flex;
  justify-content:center;
  gap:2px;
  margin-bottom:6px;
}
#clockNow, #dateNow{
  font-weight:700;
}
#clockNow{ font-size:2.4rem; }
#dateNow{ font-size:1.4rem; color:var(--muted); }

#quick-row{
  display:flex;
  justify-content:center;
  gap:12px;
  align-items:center;
}
.quick-group{
  display:flex;
  gap:8px;
  align-items:center;
}
#quick-buttons button{
  border:none;
  padding:8px 16px;
  font-size:1.4rem;
  font-weight:700;
  border-radius:10px;
  cursor:pointer;
  transition:0.15s;
}
#quick-buttons button:hover{
  opacity:0.85;
  transform:translateY(-2px);
}
.divider-vertical{
  width:1px;
  height:36px;
  background:rgba(255,255,255,0.08);
  border-radius:2px;
  margin-left:6px;
  margin-right:6px;
  box-shadow:0 0 8px rgba(0,0,0,0.25) inset;
}

.wrap{
  max-width:1500px;
  margin:0 auto;
  padding:0 20px 20px;
}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(320px,1fr));
  gap:20px;
  margin-top:12px;
}

.timer-card{
  position:relative;
  padding:2px 4px;
  border-radius:16px;
  background:rgba(255,255,255,0.06);
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:0px;
  overflow:hidden;
  border:none;
}
.timer-card::before{
  content:"";
  position:absolute;
  top:0;
  left:0;
  width:6px;
  height:100%;
  background:var(--flare,#ffffff55);
  border-radius:16px 0 0 16px;
  box-shadow:0 0 12px var(--flare);
}

.close-btn{
  position:absolute;
  top:6px;
  right:8px;
  font-size:1.2rem;
  font-weight:900;
  cursor:pointer;
  opacity:0.7;
  transition:0.2s;
  user-select:none;
  background:transparent;
  border:none;
  color:inherit;
}
.close-btn:hover{opacity:1;}

.title{
  font-size:1.6rem;
  font-weight:800;
  text-align:center;
  margin-bottom:1px;
}
.title[contenteditable="true"]{
  padding:2px 4px;
  border-radius:6px;
  outline:2px solid rgba(255,255,255,0.4);
  background:rgba(255,255,255,0.15);
}

.svg-wrap{
  width:200px;
  height:200px;
  position:relative;
  padding:8px;
  box-sizing:border-box;
}
.svg-wrap svg{
  width:100%;
  height:100%;
  transform:rotate(-90deg);
}

.time-text{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:3.8rem;
  font-weight:900;
  pointer-events:none;
}

.last-ten{
  margin-top:1px;
  font-size:1.6rem;
  font-weight:700;
  color:#ff5555;
  text-shadow:0 0 8px rgba(255,0,0,0.45);
  display:none;
  animation: pulse 1s infinite;
}

.first-ten{
  margin-top:1px;
  font-size:1.6rem;
  font-weight:700;
  color:#55ff66;
  text-shadow:0 0 8px rgba(0,255,100,0.35);
  display:none;
  animation: pulse 1s infinite;
}

@keyframes pulse{
  0%,100%{ transform: scale(1);}
  50%{ transform: scale(1.15);}
}

.pop-show{
  animation:pop-in .35s both;
}
@keyframes pop-in{
  from{opacity:0; transform:translateY(12px) scale(.95)}
  to{opacity:1; transform:translateY(0) scale(1)}
}

.pause-btn{
  position:absolute;
  bottom:14px;
  left:50%;
  transform:translateX(-50%);
  width:36px;
  height:36px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:18px;
  font-weight:800;
  cursor:pointer;
  border:none;
  background:rgba(0,0,0,0.45);
  color:#fff;
  transition:0.12s;
  z-index:5;
}
.pause-btn:hover{ transform:translateX(-50%) scale(1.1); }
.day .pause-btn{ background:rgba(255,255,255,0.9); color:#000; }

.labels-row{
  display:flex;
  gap:6px;
  align-items:center;
  margin-top:4px;
  margin-bottom:4px;
}

@media (max-width:420px){
  .svg-wrap{ width:180px; height:180px; }
  .time-text{ font-size:3.0rem; }
  #clockNow{ font-size:2rem; }
  #dateNow{ font-size:1.2rem; }
}
</style>
</head>
<body>

<div id="top-bar">
 <div id="clockDateRow" style="flex-direction:column; align-items:center; gap:2px;">
  <div id="clockNow">--:--:--</div>
  <div id="dateNow">Loading...</div>
</div>

  <div id="quick-row">
    <div class="quick-group" id="quick-buttons">
      <button style="background:#ff6b6b;color:#fff" onclick="addQuickTimer(5)">5</button>
      <button style="background:#6bbbff;color:#fff" onclick="addQuickTimer(15)">15</button>
      <button style="background:#5af0c6;color:#000" onclick="addQuickTimer(20)">20</button>
      <button style="background:#c38bff;color:#fff" onclick="addCustomTimer()">&#8734;</button>
    </div>

    <div class="divider-vertical" aria-hidden="true"></div>

    <div class="quick-group" id="control-buttons">
      <button id="dayToggle" style="background:#fff;font-size:1.2rem;">☀️</button>
      <button id="fullscreenToggle" style="background:#ff8b6b;font-size:1.2rem;">⛶</button>
    </div>
  </div>
</div>

<div class="wrap">
  <div class="grid" id="activeTimers"></div>
</div>

<script>
const periods = [
  { id:'pre1',name:"They're Coming...",start:'08:30',end:'09:25' },
  { id:'p1',name:'Launch Time',start:'09:25',end:'09:40' },
  { id:'p2',name:'Period 1',start:'09:40',end:'10:22' },
  { id:'p3',name:'Passing',start:'10:22',end:'10:26' },
  { id:'p4',name:'Period 2',start:'10:26',end:'11:08' },
  { id:'p5',name:'Passing',start:'11:08',end:'11:12' },
  { id:'p6',name:'Period 3',start:'11:12',end:'12:40' },
  { id:'p7',name:'Lunch',start:'12:40',end:'13:10' },
  { id:'p8',name:'Passing',start:'13:10',end:'13:15' },
  { id:'p9',name:'Period 5',start:'13:15',end:'14:43' },
  { id:'p10',name:'Passing',start:'14:43',end:'14:47' },
  { id:'p11',name:'Period 7',start:'14:47',end:'16:15' },
  { id:'p12',name:'Cleanup',start:'16:10',end:'16:15' },
  { id:'p13',name:'GET OUT',start:'16:15',end:'16:25' },
  { id:'post1',name:"Why Are You Still Here?",start:'16:25',end:'16:40' }
];

const palette=['#ff6b6b','#6bbbff','#6bff95','#5af0c6','#c38bff','#ff8bd8','#ffb27b','#8fbeff','#ffd86b','#ffe08a'];
const periodColorMap={}; periods.forEach((p,i)=> periodColorMap[p.id]=palette[i % palette.length]);
let dayModeActive=false;
let customTimerCount=0; const customTimers=[];

// CLOCK
function updateClock(){
  const d=new Date();
  document.getElementById('clockNow').textContent=d.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:true});
  document.getElementById('dateNow').textContent=d.toLocaleDateString([], {weekday:'long',year:'numeric',month:'long',day:'numeric'});
  const col = dayModeActive ? '#000' : '#fff';
  document.getElementById('clockNow').style.color=col;
  document.getElementById('dateNow').style.color=dayModeActive?'#000':'var(--muted)';
}
setInterval(updateClock,1000); updateClock();

// HELPERS
function humanHMS(sec){ sec=Math.max(0,sec); return `${Math.floor(sec/60)}:${String(sec%60).padStart(2,'0')}`;}
function toDate(hhmm,ref){ const [h,m]=hhmm.split(':').map(Number); const d=new Date(ref); d.setHours(h,m,0,0); return d;}
function getActivePeriods(now=new Date()){
  const out=[];
  for(const p of periods){
    let st=toDate(p.start,now);
    let en=toDate(p.end,now);
    if(en<=st) en=new Date(en.getTime()+86400000);
    if(now>=st && now<en){
      const total=Math.round((en.getTime()-st.getTime())/1000);
      const remain=Math.max(0, Math.ceil((en.getTime()-now.getTime())/1000));
      out.push({period:p,total,remain,st,en});
    }
  }
  return out;
}

// CUSTOM TIMERS
function addQuickTimer(min){ createCustomTimer(min); }
function addCustomTimer(){
  let val=prompt("Minutes?"); if(!val)return; val=parseInt(val);
  if(isNaN(val)||val<=0) return alert("Enter a valid number");
  createCustomTimer(val);
}
function createCustomTimer(minutes){
  const now=new Date();
  const id="c"+(++customTimerCount);
  const color=palette[(customTimerCount-1)%palette.length];
  const total=Math.round(minutes*60);
  const end=new Date(now.getTime()+total*1000);
  const t={id,name:`${minutes}-Minute Timer`,total,end,color,_baseColor:color,paused:false};
  customTimers.push(t); tick();
}

// FULL CARD CREATION, UPDATE, REMOVE (same as your v5 logic)
function createCard(info,id,label,color,isCustom){
  const card=document.createElement("div");
  card.className="timer-card pop-show";
  card.dataset.pid=id; card.dataset.custom=isCustom?'1':'0'; card._baseColor=color;
  card.style.setProperty("--flare", color+"AA"); card.style.border="none";

  if(isCustom){
    const close=document.createElement("button");
    close.className="close-btn";
    close.textContent="×";
    close.onclick=()=>{ removeCustomTimer(id); playChime(); };
    card.appendChild(close);
  }

  const title=document.createElement("div"); title.className="title"; title.textContent=label;
  if(isCustom){
    title.contentEditable=true; title.spellcheck=false;
    title.addEventListener("keydown",e=>{ if(e.key==="Enter"){ e.preventDefault(); title.blur(); } });
    title.addEventListener("blur",()=>{ const t=customTimers.find(t=>t.id===id); if(t) t.name=title.textContent.trim()||t.name; });
  }

  const wrap=document.createElement("div"); wrap.className="svg-wrap";
  const NS="http://www.w3.org/2000/svg";
  const svg=document.createElementNS(NS,"svg"); svg.setAttribute("viewBox","0 0 120 120");
  const r=52, C=2*Math.PI*r;
  const bg=document.createElementNS(NS,"circle"); bg.setAttribute("cx",60); bg.setAttribute("cy",60); bg.setAttribute("r",r);
  bg.setAttribute("fill","none"); bg.setAttribute("stroke","#ffffff33"); bg.setAttribute("stroke-width",10);
  const fg=document.createElementNS(NS,"circle"); fg.setAttribute("cx",60); fg.setAttribute("cy",60); fg.setAttribute("r",r);
  fg.setAttribute("fill","none"); fg.setAttribute("stroke",color); fg.setAttribute("stroke-width",10);
  fg.setAttribute("stroke-linecap","round"); fg.setAttribute("stroke-dasharray",C); fg.setAttribute("stroke-dashoffset",C);
  svg.appendChild(bg); svg.appendChild(fg);
  wrap.appendChild(svg);

  const tt=document.createElement("div"); tt.className="time-text";
  tt.innerHTML=`<span>${humanHMS(info.remain)}</span>`;
  wrap.appendChild(tt);

  const pauseBtn=document.createElement("button");
  pauseBtn.className="pause-btn";
  pauseBtn.title = "Pause / Resume";
  pauseBtn.textContent = info.custom && info.paused ? "▶" : "⏸";
  pauseBtn.onclick = (e)=>{ e.stopPropagation(); togglePauseCustom(info.id); };
  pauseBtn.style.display = info.custom ? "flex" : "none";
  wrap.appendChild(pauseBtn);

  const last=document.createElement("div"); last.className="last-ten"; last.textContent="Last Ten";
  const first=document.createElement("div"); first.className="first-ten"; first.textContent="First Ten: ATTENDANCE";

  card.appendChild(title); card.appendChild(wrap);

  if(!isCustom){
    const labelsRow=document.createElement("div"); labelsRow.className="labels-row";
    labelsRow.appendChild(first); labelsRow.appendChild(last);
    card.appendChild(labelsRow);
  } else {
    const spacer=document.createElement("div"); spacer.style.height="26px"; card.appendChild(spacer);
  }

  card._refs={fg,tt:tt.querySelector("span"),last,first,bg,pauseBtn,svg};
  card._total=info.total;

  updateCard(card,info); syncCardMode(card); return card;
}

function updateCard(card,info){
  const r=card._refs; if(!r) return;
  card._total = info.total;
  r.tt.textContent=humanHMS(info.remain);
  const C=parseFloat(r.fg.getAttribute("stroke-dasharray"));
  const ratio = Math.max(0, Math.min(1, (1 - info.remain/card._total)));
  r.fg.setAttribute("stroke-dashoffset", Math.round(ratio * C));

  if(card.dataset.custom !== '1' && card._total >= 1200){
    if(r.first) r.first.style.display = (info.remain >= (card._total - 600)) ? "block" : "none";
    if(r.last) r.last.style.display = (info.remain <= 600) ? "block" : "none";
  } else { if(r.first) r.first.style.display = "none"; if(r.last) r.last.style.display = "none"; }

  if(card.dataset.custom==='1'){
    r.pauseBtn.style.display="flex";
    const t=customTimers.find(x=>x.id===card.dataset.pid);
    r.pauseBtn.textContent=(t && t.paused)?"▶":"⏸";
  } else r.pauseBtn.style.display="none";

  syncCardMode(card);
}

function removeCustomTimer(id){
  const index=customTimers.findIndex(t=>t.id===id); if(index>=0) customTimers.splice(index,1);
  const card=document.querySelector(`[data-pid="${id}"]`);
  if(card){ card.style.opacity="0"; card.style.transform="translateY(20px) scale(.95)"; setTimeout(()=>card.remove(),300); }
}

function syncCardMode(card){
  const col=card._baseColor||"#fff";
  if(dayModeActive){
    card.style.color="#000"; card.style.setProperty("--flare", col+"AA");
    if(card.dataset.custom==='1'){
      card.style.background=col;
      card._refs.fg.setAttribute("stroke","#fff");
      card._refs.bg.setAttribute("stroke",col);
    } else {
      card.style.background=col;
      card._refs.fg.setAttribute("stroke","#ffffff66");
      card._refs.bg.setAttribute("stroke",col);
    }
  } else {
    card.style.background="rgba(255,255,255,0.06)";
    card.style.color="#fff";
    card._refs.fg.setAttribute("stroke",col);
    card._refs.bg.setAttribute("stroke","#ffffff33");
  }
}

function playChime(){
  try{
    const ctx=new (window.AudioContext||window.webkitAudioContext)();
    const now=ctx.currentTime;
    for(let i=0;i<3;i++){
      const o=ctx.createOscillator(); const g=ctx.createGain();
      o.frequency.value = i%2===0 ? 880 : 660; o.type="sine";
      g.gain.setValueAtTime(0.1, now + i*0.28);
      o.connect(g); g.connect(ctx.destination);
      o.start(now + i*0.28); o.stop(now + i*0.28 + 0.18);
    }
  }catch(e){}
}

function togglePauseCustom(id){
  const t=customTimers.find(x=>x.id===id); if(!t) return;
  const now=new Date();
  if(t.paused){
    t.end=new Date(now.getTime()+(t.pauseRemaining||0)*1000);
    delete t.pauseRemaining;
    t.paused=false;
  } else {
    t.pauseRemaining=Math.max(0, Math.ceil((t.end.getTime()-now.getTime())/1000));
    t.paused=true;
    delete t.end;
  }
  tick();
}

const container=document.getElementById("activeTimers");
function tick(){
  const now=new Date();
  const activePeriods=getActivePeriods(now);
  const activeCustom=customTimers.map(t=>{
    const remain=t.paused?Math.max(0,Math.round(t.pauseRemaining||0)):Math.max(0,Math.ceil((t.end.getTime()-now.getTime())/1000));
    return {...t, remain};
  }).filter(t=>t.remain>0);

  const all=[];
  activePeriods.forEach(p=>{
    all.push({id:p.period.id,label:p.period.name,total:p.total,remain:p.remain,color:periodColorMap[p.period.id],custom:false});
  });
  activeCustom.forEach(t=>{
    all.push({id:t.id,label:t.name,total:t.total,remain:t.remain,color:t.color,custom:true,paused:t.paused});
  });

  const live=new Set(all.map(a=>a.id));

  all.forEach(info=>{
    let card=document.querySelector(`[data-pid="${info.id}"]`);
    if(!card){ card=createCard(info,info.id,info.label,info.color,info.custom); container.appendChild(card); }
    else updateCard(card,info);
  });

  document.querySelectorAll(".timer-card").forEach(card=>{
    if(!live.has(card.dataset.pid)){
      if(card.dataset.custom==='1') playChime();
      card.style.opacity="0"; card.style.transform="translateY(20px) scale(.95)";
      setTimeout(()=>card.remove(),350);
    }
  });
}
tick(); setInterval(tick,1000);

// DAY/NIGHT TOGGLE
const dayBtn=document.getElementById("dayToggle");
dayBtn.onclick=()=>{
  dayModeActive=!dayModeActive;
  document.body.style.background=dayModeActive?"#fdfdfd":"linear-gradient(180deg,var(--bg1),var(--bg2))";
  document.querySelectorAll(".timer-card").forEach(syncCardMode);
  document.querySelectorAll("#quick-buttons button").forEach(btn=>{
    btn.style.color=dayModeActive?"#000":"#fff";
  });
};
const fsBtn=document.getElementById("fullscreenToggle");
fsBtn.onclick = ()=>{ if(document.fullscreenElement) document.exitFullscreen(); else document.documentElement.requestFullscreen().catch(()=>{}); };
document.addEventListener("fullscreenchange",()=>{ fsBtn.style.background=document.fullscreenElement?"#6bff95":"#ff8b6b"; });
</script>
</body>
</html>
